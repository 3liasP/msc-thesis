% generated by Plantuml 1.2025.9       
\definecolor{plantucolor0000}{RGB}{255,255,255}
\definecolor{plantucolor0001}{RGB}{0,0,0}
\definecolor{plantucolor0002}{RGB}{255,255,255}
\begin{tikzpicture}[yscale=-1
,pstyle0/.style={color=black,fill=white,line width=1.0pt}
,pstyle1/.style={color=plantucolor0002,line width=0.0pt}
,pstyle2/.style={color=black,line width=1.0pt,dash pattern=on 5.0pt off 5.0pt}
,pstyle3/.style={color=black,line width=1.0pt}
,pstyle4/.style={color=black,fill=black,line width=1.0pt}
,pstyle5/.style={color=black,line width=1.0pt,dash pattern=on 2.0pt off 2.0pt}
]
\draw[pstyle0] (161.93pt,102pt) rectangle (171.93pt,774.2pt);
\draw[pstyle0] (295.29pt,137pt) rectangle (305.29pt,676.2pt);
\draw[pstyle0] (468.88pt,198pt) rectangle (478.88pt,652.2pt);
\draw[pstyle0] (630.3901pt,222pt) rectangle (640.3901pt,283pt);
\draw[pstyle0] (783.3401pt,317.1pt) rectangle (793.3401pt,425.1pt);
\draw[pstyle0] (783.3401pt,594.2pt) rectangle (793.3401pt,618.2pt);
\draw[pstyle0] (927.1701pt,536.1pt) rectangle (937.1701pt,560.1pt);
\draw[pstyle1] (20pt,76pt) rectangle (28pt,792.2pt);
\draw[pstyle2] (24pt,76pt) -- (24pt,792.2pt);
\draw[pstyle1] (162.93pt,76pt) rectangle (170.93pt,792.2pt);
\draw[pstyle2] (166.875pt,76pt) -- (166.875pt,792.2pt);
\draw[pstyle1] (296.29pt,76pt) rectangle (304.29pt,792.2pt);
\draw[pstyle2] (299.5pt,76pt) -- (299.5pt,792.2pt);
\draw[pstyle1] (469.88pt,76pt) rectangle (477.88pt,792.2pt);
\draw[pstyle2] (473.86pt,76pt) -- (473.86pt,792.2pt);
\draw[pstyle1] (631.3901pt,76pt) rectangle (639.3901pt,792.2pt);
\draw[pstyle2] (635.0801pt,76pt) -- (635.0801pt,792.2pt);
\draw[pstyle1] (784.3401pt,76pt) rectangle (792.3401pt,792.2pt);
\draw[pstyle2] (788.1851pt,76pt) -- (788.1851pt,792.2pt);
\draw[pstyle1] (928.1701pt,76pt) rectangle (936.1701pt,792.2pt);
\draw[pstyle2] (931.9551pt,76pt) -- (931.9551pt,792.2pt);
\node at (11.1pt,66pt)[below right,color=black,inner sep=0]{User};
\draw[pstyle0] (24pt,14pt) ellipse (8pt and 8pt);
\draw[pstyle3] (24pt,22pt) -- (24pt,49pt)(11pt,30pt) -- (37pt,30pt)(24pt,49pt) -- (11pt,64pt)(24pt,49pt) -- (37pt,64pt);
\node at (11.1pt,791.2pt)[below right,color=black,inner sep=0]{User};
\draw[pstyle0] (24pt,810.2pt) ellipse (8pt and 8pt);
\draw[pstyle3] (24pt,818.2pt) -- (24pt,845.2pt)(11pt,826.2pt) -- (37pt,826.2pt)(24pt,845.2pt) -- (11pt,860.2pt)(24pt,845.2pt) -- (37pt,860.2pt);
\draw[pstyle0] (141.875pt,56pt) arc (180:270:5pt) -- (146.875pt,51pt) -- (186.985pt,51pt) arc (270:360:5pt) -- (191.985pt,56pt) -- (191.985pt,70pt) arc (0:90:5pt) -- (186.985pt,75pt) -- (146.875pt,75pt) arc (90:180:5pt) -- (141.875pt,70pt) -- cycle;
\node at (148.875pt,58pt)[below right,color=black,inner sep=0]{Chat UI};
\draw[pstyle0] (141.875pt,796.2pt) arc (180:270:5pt) -- (146.875pt,791.2pt) -- (186.985pt,791.2pt) arc (270:360:5pt) -- (191.985pt,796.2pt) -- (191.985pt,810.2pt) arc (0:90:5pt) -- (186.985pt,815.2pt) -- (146.875pt,815.2pt) arc (90:180:5pt) -- (141.875pt,810.2pt) -- cycle;
\node at (148.875pt,798.2pt)[below right,color=black,inner sep=0]{Chat UI};
\draw[pstyle0] (270.5pt,56pt) arc (180:270:5pt) -- (275.5pt,51pt) -- (325.08pt,51pt) arc (270:360:5pt) -- (330.08pt,56pt) -- (330.08pt,70pt) arc (0:90:5pt) -- (325.08pt,75pt) -- (275.5pt,75pt) arc (90:180:5pt) -- (270.5pt,70pt) -- cycle;
\node at (277.5pt,58pt)[below right,color=black,inner sep=0]{API Layer};
\draw[pstyle0] (270.5pt,796.2pt) arc (180:270:5pt) -- (275.5pt,791.2pt) -- (325.08pt,791.2pt) arc (270:360:5pt) -- (330.08pt,796.2pt) -- (330.08pt,810.2pt) arc (0:90:5pt) -- (325.08pt,815.2pt) -- (275.5pt,815.2pt) arc (90:180:5pt) -- (270.5pt,810.2pt) -- cycle;
\node at (277.5pt,798.2pt)[below right,color=black,inner sep=0]{API Layer};
\draw[pstyle0] (434.86pt,56pt) arc (180:270:5pt) -- (439.86pt,51pt) -- (507.9pt,51pt) arc (270:360:5pt) -- (512.9pt,56pt) -- (512.9pt,70pt) arc (0:90:5pt) -- (507.9pt,75pt) -- (439.86pt,75pt) arc (90:180:5pt) -- (434.86pt,70pt) -- cycle;
\node at (441.86pt,58pt)[below right,color=black,inner sep=0]{Business Logic};
\draw[pstyle0] (434.86pt,796.2pt) arc (180:270:5pt) -- (439.86pt,791.2pt) -- (507.9pt,791.2pt) arc (270:360:5pt) -- (512.9pt,796.2pt) -- (512.9pt,810.2pt) arc (0:90:5pt) -- (507.9pt,815.2pt) -- (439.86pt,815.2pt) arc (90:180:5pt) -- (434.86pt,810.2pt) -- cycle;
\node at (441.86pt,798.2pt)[below right,color=black,inner sep=0]{Business Logic};
\draw[pstyle0] (606.0801pt,56pt) arc (180:270:5pt) -- (611.0801pt,51pt) -- (659.7001pt,51pt) arc (270:360:5pt) -- (664.7001pt,56pt) -- (664.7001pt,70pt) arc (0:90:5pt) -- (659.7001pt,75pt) -- (611.0801pt,75pt) arc (90:180:5pt) -- (606.0801pt,70pt) -- cycle;
\node at (613.0801pt,58pt)[below right,color=black,inner sep=0]{Embedder};
\draw[pstyle0] (606.0801pt,796.2pt) arc (180:270:5pt) -- (611.0801pt,791.2pt) -- (659.7001pt,791.2pt) arc (270:360:5pt) -- (664.7001pt,796.2pt) -- (664.7001pt,810.2pt) arc (0:90:5pt) -- (659.7001pt,815.2pt) -- (611.0801pt,815.2pt) arc (90:180:5pt) -- (606.0801pt,810.2pt) -- cycle;
\node at (613.0801pt,798.2pt)[below right,color=black,inner sep=0]{Embedder};
\node at (759.1851pt,55.89pt)[below right,color=black,inner sep=0]{PostgreSQL};
\node at (761.1601pt,66pt)[below right,color=black,inner sep=0]{+ pgvector};
\draw[pstyle0] (770.3401pt,19.89pt) ..controls (770.3401pt,9.89pt) and (788.3401pt,9.89pt) .. (788.3401pt,9.89pt) ..controls (788.3401pt,9.89pt) and (806.3401pt,9.89pt) .. (806.3401pt,19.89pt) -- (806.3401pt,45.89pt) ..controls (806.3401pt,55.89pt) and (788.3401pt,55.89pt) .. (788.3401pt,55.89pt) ..controls (788.3401pt,55.89pt) and (770.3401pt,55.89pt) .. (770.3401pt,45.89pt) -- (770.3401pt,19.89pt);
\draw[pstyle3] (770.3401pt,19.89pt) ..controls (770.3401pt,29.89pt) and (788.3401pt,29.89pt) .. (788.3401pt,29.89pt) ..controls (788.3401pt,29.89pt) and (806.3401pt,29.89pt) .. (806.3401pt,19.89pt);
\node at (759.1851pt,791.2pt)[below right,color=black,inner sep=0]{PostgreSQL};
\node at (761.1601pt,801.3099pt)[below right,color=black,inner sep=0]{+ pgvector};
\draw[pstyle0] (770.3401pt,821.3099pt) ..controls (770.3401pt,811.3099pt) and (788.3401pt,811.3099pt) .. (788.3401pt,811.3099pt) ..controls (788.3401pt,811.3099pt) and (806.3401pt,811.3099pt) .. (806.3401pt,821.3099pt) -- (806.3401pt,847.3099pt) ..controls (806.3401pt,857.3099pt) and (788.3401pt,857.3099pt) .. (788.3401pt,857.3099pt) ..controls (788.3401pt,857.3099pt) and (770.3401pt,857.3099pt) .. (770.3401pt,847.3099pt) -- (770.3401pt,821.3099pt);
\draw[pstyle3] (770.3401pt,821.3099pt) ..controls (770.3401pt,831.3099pt) and (788.3401pt,831.3099pt) .. (788.3401pt,831.3099pt) ..controls (788.3401pt,831.3099pt) and (806.3401pt,831.3099pt) .. (806.3401pt,821.3099pt);
\draw[pstyle0] (893.9551pt,56pt) arc (180:270:5pt) -- (898.9551pt,51pt) -- (965.3851pt,51pt) arc (270:360:5pt) -- (970.3851pt,56pt) -- (970.3851pt,70pt) arc (0:90:5pt) -- (965.3851pt,75pt) -- (898.9551pt,75pt) arc (90:180:5pt) -- (893.9551pt,70pt) -- cycle;
\node at (900.9551pt,58pt)[below right,color=black,inner sep=0]{LLM Provider};
\draw[pstyle0] (893.9551pt,796.2pt) arc (180:270:5pt) -- (898.9551pt,791.2pt) -- (965.3851pt,791.2pt) arc (270:360:5pt) -- (970.3851pt,796.2pt) -- (970.3851pt,810.2pt) arc (0:90:5pt) -- (965.3851pt,815.2pt) -- (898.9551pt,815.2pt) arc (90:180:5pt) -- (893.9551pt,810.2pt) -- cycle;
\node at (900.9551pt,798.2pt)[below right,color=black,inner sep=0]{LLM Provider};
\draw[pstyle0] (161.93pt,102pt) rectangle (171.93pt,774.2pt);
\draw[pstyle0] (295.29pt,137pt) rectangle (305.29pt,676.2pt);
\draw[pstyle0] (468.88pt,198pt) rectangle (478.88pt,652.2pt);
\draw[pstyle0] (630.3901pt,222pt) rectangle (640.3901pt,283pt);
\draw[pstyle0] (783.3401pt,317.1pt) rectangle (793.3401pt,425.1pt);
\draw[pstyle0] (783.3401pt,594.2pt) rectangle (793.3401pt,618.2pt);
\draw[pstyle0] (927.1701pt,536.1pt) rectangle (937.1701pt,560.1pt);
\draw[pstyle4] (149.93pt,98pt) -- (159.93pt,102pt) -- (149.93pt,106pt) -- (153.93pt,102pt) -- cycle;
\draw[pstyle3] (24pt,102pt) -- (155.93pt,102pt);
\node at (31pt,90pt)[below right,color=black,inner sep=0]{Submit Query};
\draw[pstyle4] (283.29pt,133pt) -- (293.29pt,137pt) -- (283.29pt,141pt) -- (287.29pt,137pt) -- cycle;
\draw[pstyle3] (171.93pt,137pt) -- (289.29pt,137pt);
\node at (178.93pt,114pt)[below right,color=black,inner sep=0]{POST /help};
\node at (178.93pt,125pt)[below right,color=black,inner sep=0]{\{prompt, sessionToken\}};
\draw[pstyle3] (305.29pt,161pt) -- (347.29pt,161pt);
\draw[pstyle3] (347.29pt,161pt) -- (347.29pt,174pt);
\draw[pstyle3] (306.29pt,174pt) -- (347.29pt,174pt);
\draw[pstyle4] (316.29pt,170pt) -- (306.29pt,174pt) -- (316.29pt,178pt) -- (312.29pt,174pt) -- cycle;
\node at (312.29pt,149pt)[below right,color=black,inner sep=0]{Validate Session};
\draw[pstyle4] (456.88pt,194pt) -- (466.88pt,198pt) -- (456.88pt,202pt) -- (460.88pt,198pt) -- cycle;
\draw[pstyle3] (305.29pt,198pt) -- (462.88pt,198pt);
\node at (312.29pt,186pt)[below right,color=black,inner sep=0]{Process Query(prompt, userKey)};
\draw[pstyle4] (618.3901pt,218pt) -- (628.3901pt,222pt) -- (618.3901pt,226pt) -- (622.3901pt,222pt) -- cycle;
\draw[pstyle3] (478.88pt,222pt) -- (624.3901pt,222pt);
\node at (485.88pt,210pt)[below right,color=black,inner sep=0]{Generate Embedding(prompt)};
\draw[pstyle3] (640.3901pt,246pt) -- (682.3901pt,246pt);
\draw[pstyle3] (682.3901pt,246pt) -- (682.3901pt,259pt);
\draw[pstyle3] (641.3901pt,259pt) -- (682.3901pt,259pt);
\draw[pstyle4] (651.3901pt,255pt) -- (641.3901pt,259pt) -- (651.3901pt,263pt) -- (647.3901pt,259pt) -- cycle;
\node at (647.3901pt,234pt)[below right,color=black,inner sep=0]{Queue Embedding Request};
\draw[pstyle4] (489.88pt,279pt) -- (479.88pt,283pt) -- (489.88pt,287pt) -- (485.88pt,283pt) -- cycle;
\draw[pstyle5] (483.88pt,283pt) -- (634.3901pt,283pt);
\node at (495.88pt,271pt)[below right,color=black,inner sep=0]{Embedding Vector};
\draw[pstyle4] (771.3401pt,313.1pt) -- (781.3401pt,317.1pt) -- (771.3401pt,321.1pt) -- (775.3401pt,317.1pt) -- cycle;
\draw[pstyle3] (478.88pt,317.1pt) -- (777.3401pt,317.1pt);
\node at (485.88pt,295pt)[below right,color=black,inner sep=0]{Vector Similarity Search};
\node at (485.88pt,305.1pt)[below right,color=black,inner sep=0]{(embedding, k=5, userKey)};
\draw[pstyle3] (793.3401pt,341.1pt) -- (835.3401pt,341.1pt);
\draw[pstyle3] (835.3401pt,341.1pt) -- (835.3401pt,354.1pt);
\draw[pstyle3] (794.3401pt,354.1pt) -- (835.3401pt,354.1pt);
\draw[pstyle4] (804.3401pt,350.1pt) -- (794.3401pt,354.1pt) -- (804.3401pt,358.1pt) -- (800.3401pt,354.1pt) -- cycle;
\node at (800.3401pt,329.1pt)[below right,color=black,inner sep=0]{Filter by Permissions};
\draw[pstyle3] (793.3401pt,378.1pt) -- (835.3401pt,378.1pt);
\draw[pstyle3] (835.3401pt,378.1pt) -- (835.3401pt,391.1pt);
\draw[pstyle3] (794.3401pt,391.1pt) -- (835.3401pt,391.1pt);
\draw[pstyle4] (804.3401pt,387.1pt) -- (794.3401pt,391.1pt) -- (804.3401pt,395.1pt) -- (800.3401pt,391.1pt) -- cycle;
\node at (800.3401pt,366.1pt)[below right,color=black,inner sep=0]{Cosine Distance Ranking};
\draw[pstyle4] (489.88pt,421.1pt) -- (479.88pt,425.1pt) -- (489.88pt,429.1pt) -- (485.88pt,425.1pt) -- cycle;
\draw[pstyle5] (483.88pt,425.1pt) -- (787.3401pt,425.1pt);
\node at (495.88pt,403.1pt)[below right,color=black,inner sep=0]{Top-K Chunks};
\node at (495.88pt,413.1pt)[below right,color=black,inner sep=0]{+ Source Metadata};
\draw[pstyle3] (478.88pt,489.1pt) -- (520.88pt,489.1pt);
\draw[pstyle3] (520.88pt,489.1pt) -- (520.88pt,502.1pt);
\draw[pstyle3] (479.88pt,502.1pt) -- (520.88pt,502.1pt);
\draw[pstyle4] (489.88pt,498.1pt) -- (479.88pt,502.1pt) -- (489.88pt,506.1pt) -- (485.88pt,502.1pt) -- cycle;
\node at (485.88pt,437.1pt)[below right,color=black,inner sep=0]{Construct Prompt:};
\node at (485.88pt,447.1pt)[below right,color=black,inner sep=0]{- System Instructions};
\node at (485.88pt,457.1pt)[below right,color=black,inner sep=0]{- Retrieved Context};
\node at (485.88pt,467.1pt)[below right,color=black,inner sep=0]{- Conversation History};
\node at (485.88pt,477.1pt)[below right,color=black,inner sep=0]{- User Question};
\draw[pstyle4] (915.1701pt,532.1pt) -- (925.1701pt,536.1pt) -- (915.1701pt,540.1pt) -- (919.1701pt,536.1pt) -- cycle;
\draw[pstyle3] (478.88pt,536.1pt) -- (921.1701pt,536.1pt);
\node at (485.88pt,514.1pt)[below right,color=black,inner sep=0]{Generate Response};
\node at (485.88pt,524.1pt)[below right,color=black,inner sep=0]{(prompt, temperature=0.2)};
\draw[pstyle4] (489.88pt,556.1pt) -- (479.88pt,560.1pt) -- (489.88pt,564.1pt) -- (485.88pt,560.1pt) -- cycle;
\draw[pstyle5] (483.88pt,560.1pt) -- (931.1701pt,560.1pt);
\node at (495.88pt,548.1pt)[below right,color=black,inner sep=0]{AI Response};
\draw[pstyle4] (771.3401pt,590.2pt) -- (781.3401pt,594.2pt) -- (771.3401pt,598.2pt) -- (775.3401pt,594.2pt) -- cycle;
\draw[pstyle3] (478.88pt,594.2pt) -- (777.3401pt,594.2pt);
\node at (485.88pt,572.1pt)[below right,color=black,inner sep=0]{Save Chat History};
\node at (485.88pt,582.2pt)[below right,color=black,inner sep=0]{(user msg, AI response, sources)};
\draw[pstyle4] (489.88pt,614.2pt) -- (479.88pt,618.2pt) -- (489.88pt,622.2pt) -- (485.88pt,618.2pt) -- cycle;
\draw[pstyle5] (483.88pt,618.2pt) -- (787.3401pt,618.2pt);
\node at (495.88pt,606.2pt)[below right,color=black,inner sep=0]{Message IDs};
\draw[pstyle4] (316.29pt,648.2pt) -- (306.29pt,652.2pt) -- (316.29pt,656.2pt) -- (312.29pt,652.2pt) -- cycle;
\draw[pstyle5] (310.29pt,652.2pt) -- (472.88pt,652.2pt);
\node at (322.29pt,630.2pt)[below right,color=black,inner sep=0]{Response + Sources};
\node at (322.29pt,640.2pt)[below right,color=black,inner sep=0]{+ Message ID};
\draw[pstyle4] (182.93pt,672.2pt) -- (172.93pt,676.2pt) -- (182.93pt,680.2pt) -- (178.93pt,676.2pt) -- cycle;
\draw[pstyle5] (176.93pt,676.2pt) -- (299.29pt,676.2pt);
\node at (188.93pt,664.2pt)[below right,color=black,inner sep=0]{JSON Response};
\draw[pstyle3] (171.93pt,700.2pt) -- (213.93pt,700.2pt);
\draw[pstyle3] (213.93pt,700.2pt) -- (213.93pt,713.2pt);
\draw[pstyle3] (172.93pt,713.2pt) -- (213.93pt,713.2pt);
\draw[pstyle4] (182.93pt,709.2pt) -- (172.93pt,713.2pt) -- (182.93pt,717.2pt) -- (178.93pt,713.2pt) -- cycle;
\node at (178.93pt,688.2pt)[below right,color=black,inner sep=0]{Render Markdown};
\draw[pstyle3] (171.93pt,737.2pt) -- (213.93pt,737.2pt);
\draw[pstyle3] (213.93pt,737.2pt) -- (213.93pt,750.2pt);
\draw[pstyle3] (172.93pt,750.2pt) -- (213.93pt,750.2pt);
\draw[pstyle4] (182.93pt,746.2pt) -- (172.93pt,750.2pt) -- (182.93pt,754.2pt) -- (178.93pt,750.2pt) -- cycle;
\node at (178.93pt,725.2pt)[below right,color=black,inner sep=0]{Display Source Links};
\draw[pstyle4] (35pt,770.2pt) -- (25pt,774.2pt) -- (35pt,778.2pt) -- (31pt,774.2pt) -- cycle;
\draw[pstyle5] (29pt,774.2pt) -- (165.93pt,774.2pt);
\node at (41pt,762.2pt)[below right,color=black,inner sep=0]{AI Response with Sources};
\end{tikzpicture}
