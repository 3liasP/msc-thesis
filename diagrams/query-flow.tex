% generated by Plantuml 1.2025.9       
\definecolor{plantucolor0000}{RGB}{255,255,255}
\definecolor{plantucolor0001}{RGB}{0,0,0}
\definecolor{plantucolor0002}{RGB}{255,255,255}
\begin{tikzpicture}[yscale=-1
,pstyle0/.style={color=black,fill=white,line width=1.0pt}
,pstyle1/.style={color=plantucolor0002,line width=0.0pt}
,pstyle2/.style={color=black,line width=1.0pt,dash pattern=on 5.0pt off 5.0pt}
,pstyle3/.style={color=black,line width=1.0pt}
,pstyle4/.style={color=black,fill=black,line width=1.0pt}
,pstyle5/.style={color=black,line width=1.0pt,dash pattern=on 2.0pt off 2.0pt}
]
\draw[pstyle0] (161.93pt,102pt) rectangle (171.93pt,811.2pt);
\draw[pstyle0] (295.29pt,137pt) rectangle (305.29pt,713.2pt);
\draw[pstyle0] (468.88pt,235pt) rectangle (478.88pt,689.2pt);
\draw[pstyle0] (633.0601pt,259pt) rectangle (643.0601pt,320pt);
\draw[pstyle0] (786.0101pt,354.1pt) rectangle (796.0101pt,462.1pt);
\draw[pstyle0] (786.0101pt,631.2pt) rectangle (796.0101pt,655.2pt);
\draw[pstyle0] (929.8401pt,573.1pt) rectangle (939.8401pt,597.1pt);
\draw[pstyle1] (20pt,76pt) rectangle (28pt,829.2pt);
\draw[pstyle2] (24pt,76pt) -- (24pt,829.2pt);
\draw[pstyle1] (162.93pt,76pt) rectangle (170.93pt,829.2pt);
\draw[pstyle2] (166.875pt,76pt) -- (166.875pt,829.2pt);
\draw[pstyle1] (296.29pt,76pt) rectangle (304.29pt,829.2pt);
\draw[pstyle2] (299.5pt,76pt) -- (299.5pt,829.2pt);
\draw[pstyle1] (469.88pt,76pt) rectangle (477.88pt,829.2pt);
\draw[pstyle2] (473.86pt,76pt) -- (473.86pt,829.2pt);
\draw[pstyle1] (634.0601pt,76pt) rectangle (642.0601pt,829.2pt);
\draw[pstyle2] (637.7501pt,76pt) -- (637.7501pt,829.2pt);
\draw[pstyle1] (787.0101pt,76pt) rectangle (795.0101pt,829.2pt);
\draw[pstyle2] (790.8551pt,76pt) -- (790.8551pt,829.2pt);
\draw[pstyle1] (930.8401pt,76pt) rectangle (938.8401pt,829.2pt);
\draw[pstyle2] (934.6251pt,76pt) -- (934.6251pt,829.2pt);
\node at (11.1pt,66pt)[below right,color=black,inner sep=0]{User};
\draw[pstyle0] (24pt,14pt) ellipse (8pt and 8pt);
\draw[pstyle3] (24pt,22pt) -- (24pt,49pt)(11pt,30pt) -- (37pt,30pt)(24pt,49pt) -- (11pt,64pt)(24pt,49pt) -- (37pt,64pt);
\node at (11.1pt,828.2pt)[below right,color=black,inner sep=0]{User};
\draw[pstyle0] (24pt,847.2pt) ellipse (8pt and 8pt);
\draw[pstyle3] (24pt,855.2pt) -- (24pt,882.2pt)(11pt,863.2pt) -- (37pt,863.2pt)(24pt,882.2pt) -- (11pt,897.2pt)(24pt,882.2pt) -- (37pt,897.2pt);
\draw[pstyle0] (141.875pt,56pt) arc (180:270:5pt) -- (146.875pt,51pt) -- (186.985pt,51pt) arc (270:360:5pt) -- (191.985pt,56pt) -- (191.985pt,70pt) arc (0:90:5pt) -- (186.985pt,75pt) -- (146.875pt,75pt) arc (90:180:5pt) -- (141.875pt,70pt) -- cycle;
\node at (148.875pt,58pt)[below right,color=black,inner sep=0]{Chat UI};
\draw[pstyle0] (141.875pt,833.2pt) arc (180:270:5pt) -- (146.875pt,828.2pt) -- (186.985pt,828.2pt) arc (270:360:5pt) -- (191.985pt,833.2pt) -- (191.985pt,847.2pt) arc (0:90:5pt) -- (186.985pt,852.2pt) -- (146.875pt,852.2pt) arc (90:180:5pt) -- (141.875pt,847.2pt) -- cycle;
\node at (148.875pt,835.2pt)[below right,color=black,inner sep=0]{Chat UI};
\draw[pstyle0] (270.5pt,56pt) arc (180:270:5pt) -- (275.5pt,51pt) -- (325.08pt,51pt) arc (270:360:5pt) -- (330.08pt,56pt) -- (330.08pt,70pt) arc (0:90:5pt) -- (325.08pt,75pt) -- (275.5pt,75pt) arc (90:180:5pt) -- (270.5pt,70pt) -- cycle;
\node at (277.5pt,58pt)[below right,color=black,inner sep=0]{API Layer};
\draw[pstyle0] (270.5pt,833.2pt) arc (180:270:5pt) -- (275.5pt,828.2pt) -- (325.08pt,828.2pt) arc (270:360:5pt) -- (330.08pt,833.2pt) -- (330.08pt,847.2pt) arc (0:90:5pt) -- (325.08pt,852.2pt) -- (275.5pt,852.2pt) arc (90:180:5pt) -- (270.5pt,847.2pt) -- cycle;
\node at (277.5pt,835.2pt)[below right,color=black,inner sep=0]{API Layer};
\draw[pstyle0] (434.86pt,56pt) arc (180:270:5pt) -- (439.86pt,51pt) -- (507.9pt,51pt) arc (270:360:5pt) -- (512.9pt,56pt) -- (512.9pt,70pt) arc (0:90:5pt) -- (507.9pt,75pt) -- (439.86pt,75pt) arc (90:180:5pt) -- (434.86pt,70pt) -- cycle;
\node at (441.86pt,58pt)[below right,color=black,inner sep=0]{Business Logic};
\draw[pstyle0] (434.86pt,833.2pt) arc (180:270:5pt) -- (439.86pt,828.2pt) -- (507.9pt,828.2pt) arc (270:360:5pt) -- (512.9pt,833.2pt) -- (512.9pt,847.2pt) arc (0:90:5pt) -- (507.9pt,852.2pt) -- (439.86pt,852.2pt) arc (90:180:5pt) -- (434.86pt,847.2pt) -- cycle;
\node at (441.86pt,835.2pt)[below right,color=black,inner sep=0]{Business Logic};
\draw[pstyle0] (608.7501pt,56pt) arc (180:270:5pt) -- (613.7501pt,51pt) -- (662.3701pt,51pt) arc (270:360:5pt) -- (667.3701pt,56pt) -- (667.3701pt,70pt) arc (0:90:5pt) -- (662.3701pt,75pt) -- (613.7501pt,75pt) arc (90:180:5pt) -- (608.7501pt,70pt) -- cycle;
\node at (615.7501pt,58pt)[below right,color=black,inner sep=0]{Embedder};
\draw[pstyle0] (608.7501pt,833.2pt) arc (180:270:5pt) -- (613.7501pt,828.2pt) -- (662.3701pt,828.2pt) arc (270:360:5pt) -- (667.3701pt,833.2pt) -- (667.3701pt,847.2pt) arc (0:90:5pt) -- (662.3701pt,852.2pt) -- (613.7501pt,852.2pt) arc (90:180:5pt) -- (608.7501pt,847.2pt) -- cycle;
\node at (615.7501pt,835.2pt)[below right,color=black,inner sep=0]{Embedder};
\node at (761.8551pt,55.89pt)[below right,color=black,inner sep=0]{PostgreSQL};
\node at (763.8301pt,66pt)[below right,color=black,inner sep=0]{+ pgvector};
\draw[pstyle0] (773.0101pt,19.89pt) ..controls (773.0101pt,9.89pt) and (791.0101pt,9.89pt) .. (791.0101pt,9.89pt) ..controls (791.0101pt,9.89pt) and (809.0101pt,9.89pt) .. (809.0101pt,19.89pt) -- (809.0101pt,45.89pt) ..controls (809.0101pt,55.89pt) and (791.0101pt,55.89pt) .. (791.0101pt,55.89pt) ..controls (791.0101pt,55.89pt) and (773.0101pt,55.89pt) .. (773.0101pt,45.89pt) -- (773.0101pt,19.89pt);
\draw[pstyle3] (773.0101pt,19.89pt) ..controls (773.0101pt,29.89pt) and (791.0101pt,29.89pt) .. (791.0101pt,29.89pt) ..controls (791.0101pt,29.89pt) and (809.0101pt,29.89pt) .. (809.0101pt,19.89pt);
\node at (761.8551pt,828.2pt)[below right,color=black,inner sep=0]{PostgreSQL};
\node at (763.8301pt,838.3099pt)[below right,color=black,inner sep=0]{+ pgvector};
\draw[pstyle0] (773.0101pt,858.3099pt) ..controls (773.0101pt,848.3099pt) and (791.0101pt,848.3099pt) .. (791.0101pt,848.3099pt) ..controls (791.0101pt,848.3099pt) and (809.0101pt,848.3099pt) .. (809.0101pt,858.3099pt) -- (809.0101pt,884.3099pt) ..controls (809.0101pt,894.3099pt) and (791.0101pt,894.3099pt) .. (791.0101pt,894.3099pt) ..controls (791.0101pt,894.3099pt) and (773.0101pt,894.3099pt) .. (773.0101pt,884.3099pt) -- (773.0101pt,858.3099pt);
\draw[pstyle3] (773.0101pt,858.3099pt) ..controls (773.0101pt,868.3099pt) and (791.0101pt,868.3099pt) .. (791.0101pt,868.3099pt) ..controls (791.0101pt,868.3099pt) and (809.0101pt,868.3099pt) .. (809.0101pt,858.3099pt);
\draw[pstyle0] (896.6251pt,56pt) arc (180:270:5pt) -- (901.6251pt,51pt) -- (968.0551pt,51pt) arc (270:360:5pt) -- (973.0551pt,56pt) -- (973.0551pt,70pt) arc (0:90:5pt) -- (968.0551pt,75pt) -- (901.6251pt,75pt) arc (90:180:5pt) -- (896.6251pt,70pt) -- cycle;
\node at (903.6251pt,58pt)[below right,color=black,inner sep=0]{LLM Provider};
\draw[pstyle0] (896.6251pt,833.2pt) arc (180:270:5pt) -- (901.6251pt,828.2pt) -- (968.0551pt,828.2pt) arc (270:360:5pt) -- (973.0551pt,833.2pt) -- (973.0551pt,847.2pt) arc (0:90:5pt) -- (968.0551pt,852.2pt) -- (901.6251pt,852.2pt) arc (90:180:5pt) -- (896.6251pt,847.2pt) -- cycle;
\node at (903.6251pt,835.2pt)[below right,color=black,inner sep=0]{LLM Provider};
\draw[pstyle0] (161.93pt,102pt) rectangle (171.93pt,811.2pt);
\draw[pstyle0] (295.29pt,137pt) rectangle (305.29pt,713.2pt);
\draw[pstyle0] (468.88pt,235pt) rectangle (478.88pt,689.2pt);
\draw[pstyle0] (633.0601pt,259pt) rectangle (643.0601pt,320pt);
\draw[pstyle0] (786.0101pt,354.1pt) rectangle (796.0101pt,462.1pt);
\draw[pstyle0] (786.0101pt,631.2pt) rectangle (796.0101pt,655.2pt);
\draw[pstyle0] (929.8401pt,573.1pt) rectangle (939.8401pt,597.1pt);
\draw[pstyle4] (149.93pt,98pt) -- (159.93pt,102pt) -- (149.93pt,106pt) -- (153.93pt,102pt) -- cycle;
\draw[pstyle3] (24pt,102pt) -- (155.93pt,102pt);
\node at (31pt,90pt)[below right,color=black,inner sep=0]{Submit Query};
\draw[pstyle4] (283.29pt,133pt) -- (293.29pt,137pt) -- (283.29pt,141pt) -- (287.29pt,137pt) -- cycle;
\draw[pstyle3] (171.93pt,137pt) -- (289.29pt,137pt);
\node at (178.93pt,114pt)[below right,color=black,inner sep=0]{POST /help};
\node at (178.93pt,125pt)[below right,color=black,inner sep=0]{\{prompt, sessionToken\}};
\draw[pstyle3] (305.29pt,161pt) -- (347.29pt,161pt);
\draw[pstyle3] (347.29pt,161pt) -- (347.29pt,174pt);
\draw[pstyle3] (306.29pt,174pt) -- (347.29pt,174pt);
\draw[pstyle4] (316.29pt,170pt) -- (306.29pt,174pt) -- (316.29pt,178pt) -- (312.29pt,174pt) -- cycle;
\node at (312.29pt,149pt)[below right,color=black,inner sep=0]{Validate Session};
\draw[pstyle3] (305.29pt,198pt) -- (347.29pt,198pt);
\draw[pstyle3] (347.29pt,198pt) -- (347.29pt,211pt);
\draw[pstyle3] (306.29pt,211pt) -- (347.29pt,211pt);
\draw[pstyle4] (316.29pt,207pt) -- (306.29pt,211pt) -- (316.29pt,215pt) -- (312.29pt,211pt) -- cycle;
\node at (312.29pt,186pt)[below right,color=black,inner sep=0]{Check Rate Limits};
\draw[pstyle4] (456.88pt,231pt) -- (466.88pt,235pt) -- (456.88pt,239pt) -- (460.88pt,235pt) -- cycle;
\draw[pstyle3] (305.29pt,235pt) -- (462.88pt,235pt);
\node at (312.29pt,223pt)[below right,color=black,inner sep=0]{Process Query(prompt, userKey)};
\draw[pstyle4] (621.0601pt,255pt) -- (631.0601pt,259pt) -- (621.0601pt,263pt) -- (625.0601pt,259pt) -- cycle;
\draw[pstyle3] (478.88pt,259pt) -- (627.0601pt,259pt);
\node at (485.88pt,247pt)[below right,color=black,inner sep=0]{Generate Embedding(prompt)};
\draw[pstyle3] (643.0601pt,283pt) -- (685.0601pt,283pt);
\draw[pstyle3] (685.0601pt,283pt) -- (685.0601pt,296pt);
\draw[pstyle3] (644.0601pt,296pt) -- (685.0601pt,296pt);
\draw[pstyle4] (654.0601pt,292pt) -- (644.0601pt,296pt) -- (654.0601pt,300pt) -- (650.0601pt,296pt) -- cycle;
\node at (650.0601pt,271pt)[below right,color=black,inner sep=0]{Queue Embedding Request};
\draw[pstyle4] (489.88pt,316pt) -- (479.88pt,320pt) -- (489.88pt,324pt) -- (485.88pt,320pt) -- cycle;
\draw[pstyle5] (483.88pt,320pt) -- (637.0601pt,320pt);
\node at (495.88pt,308pt)[below right,color=black,inner sep=0]{Embedding Vector [1536-dim]};
\draw[pstyle4] (774.0101pt,350.1pt) -- (784.0101pt,354.1pt) -- (774.0101pt,358.1pt) -- (778.0101pt,354.1pt) -- cycle;
\draw[pstyle3] (478.88pt,354.1pt) -- (780.0101pt,354.1pt);
\node at (485.88pt,332pt)[below right,color=black,inner sep=0]{Vector Similarity Search};
\node at (485.88pt,342.1pt)[below right,color=black,inner sep=0]{(embedding, k=5, userKey)};
\draw[pstyle3] (796.0101pt,378.1pt) -- (838.0101pt,378.1pt);
\draw[pstyle3] (838.0101pt,378.1pt) -- (838.0101pt,391.1pt);
\draw[pstyle3] (797.0101pt,391.1pt) -- (838.0101pt,391.1pt);
\draw[pstyle4] (807.0101pt,387.1pt) -- (797.0101pt,391.1pt) -- (807.0101pt,395.1pt) -- (803.0101pt,391.1pt) -- cycle;
\node at (803.0101pt,366.1pt)[below right,color=black,inner sep=0]{Filter by Permissions};
\draw[pstyle3] (796.0101pt,415.1pt) -- (838.0101pt,415.1pt);
\draw[pstyle3] (838.0101pt,415.1pt) -- (838.0101pt,428.1pt);
\draw[pstyle3] (797.0101pt,428.1pt) -- (838.0101pt,428.1pt);
\draw[pstyle4] (807.0101pt,424.1pt) -- (797.0101pt,428.1pt) -- (807.0101pt,432.1pt) -- (803.0101pt,428.1pt) -- cycle;
\node at (803.0101pt,403.1pt)[below right,color=black,inner sep=0]{Cosine Distance Ranking};
\draw[pstyle4] (489.88pt,458.1pt) -- (479.88pt,462.1pt) -- (489.88pt,466.1pt) -- (485.88pt,462.1pt) -- cycle;
\draw[pstyle5] (483.88pt,462.1pt) -- (790.0101pt,462.1pt);
\node at (495.88pt,440.1pt)[below right,color=black,inner sep=0]{Top-K Chunks};
\node at (495.88pt,450.1pt)[below right,color=black,inner sep=0]{+ Source Metadata};
\draw[pstyle3] (478.88pt,526.1pt) -- (520.88pt,526.1pt);
\draw[pstyle3] (520.88pt,526.1pt) -- (520.88pt,539.1pt);
\draw[pstyle3] (479.88pt,539.1pt) -- (520.88pt,539.1pt);
\draw[pstyle4] (489.88pt,535.1pt) -- (479.88pt,539.1pt) -- (489.88pt,543.1pt) -- (485.88pt,539.1pt) -- cycle;
\node at (485.88pt,474.1pt)[below right,color=black,inner sep=0]{Construct Prompt:};
\node at (485.88pt,484.1pt)[below right,color=black,inner sep=0]{- System Instructions};
\node at (485.88pt,494.1pt)[below right,color=black,inner sep=0]{- Retrieved Context};
\node at (485.88pt,504.1pt)[below right,color=black,inner sep=0]{- Conversation History};
\node at (485.88pt,514.1pt)[below right,color=black,inner sep=0]{- User Question};
\draw[pstyle4] (917.8401pt,569.1pt) -- (927.8401pt,573.1pt) -- (917.8401pt,577.1pt) -- (921.8401pt,573.1pt) -- cycle;
\draw[pstyle3] (478.88pt,573.1pt) -- (923.8401pt,573.1pt);
\node at (485.88pt,551.1pt)[below right,color=black,inner sep=0]{Generate Response};
\node at (485.88pt,561.1pt)[below right,color=black,inner sep=0]{(prompt, temperature=0.2)};
\draw[pstyle4] (489.88pt,593.1pt) -- (479.88pt,597.1pt) -- (489.88pt,601.1pt) -- (485.88pt,597.1pt) -- cycle;
\draw[pstyle5] (483.88pt,597.1pt) -- (933.8401pt,597.1pt);
\node at (495.88pt,585.1pt)[below right,color=black,inner sep=0]{AI Response};
\draw[pstyle4] (774.0101pt,627.2pt) -- (784.0101pt,631.2pt) -- (774.0101pt,635.2pt) -- (778.0101pt,631.2pt) -- cycle;
\draw[pstyle3] (478.88pt,631.2pt) -- (780.0101pt,631.2pt);
\node at (485.88pt,609.1pt)[below right,color=black,inner sep=0]{Save Chat History};
\node at (485.88pt,619.2pt)[below right,color=black,inner sep=0]{(user msg, AI response, sources)};
\draw[pstyle4] (489.88pt,651.2pt) -- (479.88pt,655.2pt) -- (489.88pt,659.2pt) -- (485.88pt,655.2pt) -- cycle;
\draw[pstyle5] (483.88pt,655.2pt) -- (790.0101pt,655.2pt);
\node at (495.88pt,643.2pt)[below right,color=black,inner sep=0]{Message IDs};
\draw[pstyle4] (316.29pt,685.2pt) -- (306.29pt,689.2pt) -- (316.29pt,693.2pt) -- (312.29pt,689.2pt) -- cycle;
\draw[pstyle5] (310.29pt,689.2pt) -- (472.88pt,689.2pt);
\node at (322.29pt,667.2pt)[below right,color=black,inner sep=0]{Response + Sources};
\node at (322.29pt,677.2pt)[below right,color=black,inner sep=0]{+ Message ID};
\draw[pstyle4] (182.93pt,709.2pt) -- (172.93pt,713.2pt) -- (182.93pt,717.2pt) -- (178.93pt,713.2pt) -- cycle;
\draw[pstyle5] (176.93pt,713.2pt) -- (299.29pt,713.2pt);
\node at (188.93pt,701.2pt)[below right,color=black,inner sep=0]{JSON Response};
\draw[pstyle3] (171.93pt,737.2pt) -- (213.93pt,737.2pt);
\draw[pstyle3] (213.93pt,737.2pt) -- (213.93pt,750.2pt);
\draw[pstyle3] (172.93pt,750.2pt) -- (213.93pt,750.2pt);
\draw[pstyle4] (182.93pt,746.2pt) -- (172.93pt,750.2pt) -- (182.93pt,754.2pt) -- (178.93pt,750.2pt) -- cycle;
\node at (178.93pt,725.2pt)[below right,color=black,inner sep=0]{Render Markdown};
\draw[pstyle3] (171.93pt,774.2pt) -- (213.93pt,774.2pt);
\draw[pstyle3] (213.93pt,774.2pt) -- (213.93pt,787.2pt);
\draw[pstyle3] (172.93pt,787.2pt) -- (213.93pt,787.2pt);
\draw[pstyle4] (182.93pt,783.2pt) -- (172.93pt,787.2pt) -- (182.93pt,791.2pt) -- (178.93pt,787.2pt) -- cycle;
\node at (178.93pt,762.2pt)[below right,color=black,inner sep=0]{Display Source Links};
\draw[pstyle4] (35pt,807.2pt) -- (25pt,811.2pt) -- (35pt,815.2pt) -- (31pt,811.2pt) -- cycle;
\draw[pstyle5] (29pt,811.2pt) -- (165.93pt,811.2pt);
\node at (41pt,799.2pt)[below right,color=black,inner sep=0]{AI Response with Sources};
\end{tikzpicture}
